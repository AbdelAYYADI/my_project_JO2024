{% extends 'base.html.twig' %}

{% block title %}Panier{% endblock %}

 {% block body %}
    <div class="container border rounded bg-light-subtle mt-5 text-start">
        <table class="table table-striped caption-top mt-2">
            <caption class="bg-secondary-subtle fs-4 text-center p-2"><strong>Votre panier</strong></caption>
            <thead>
                <tr>
                    <th>Nom complet</th>
                    <th>Participants</th>
                    <th>Epreuve</th>
                    <th>Titre</th>
                    <th>Lieu</th>
                    <th>Date</th>
                    <th class="text-end">Prix Total</th>
                </tr>
            </thead>
            <tbody>
                {% set total = 0 %}
                {% for booking in bookings %}
                    {% set total = total + booking.netTotal %}
                    <tr>
                        <td>{{ booking.fullName }}</td>
                        <td>
                            {% if booking.personList is not empty %}
                                {{ booking.personList|join(', ') }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ booking.event.name }}</td>
                        <td>{{ booking.event.title }}</td>
                        <td>{{ booking.event.location }}</td>
                        <td>{{ booking.event.dateEvent.format('d-m-Y H:i') }}</td>
                        <td class="text-end">{{ booking.netTotal|number_format(2, ',', ' ') }} €</td>
                        {# <td class="text-center"><a href="{{ path('app_del_booking', {id: booking.id}) }}"><img src="{{ asset('images/trash.svg') }}" href="" alt="Supprimer"></a></td> #}
                        <td class="text-center">
                            <form method="post" action="{{ path('app_del_booking', {'id': booking.id}) }}" style="display:inline;" onsubmit="return confirm('Supprimer cette réservation ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ booking.id) }}">
                                <button type="submit" style="background: none; border: none; padding: 0;" title="Supprimer">
                                    <img src="{{ asset('images/trash.svg') }}" alt="Supprimer" style="width: 20px; height: 20px;">
                                </button>
                            </form>
                        </td>                        
                    </tr>
                {% endfor %}
                <tr>
                    <td colspan="6" class="text-end fs-5 text-primary fw-bold">Total :</td>
                    <td class="text-end fs-5 fw-bold text-primary">{{ total|number_format(2, ',', ' ') }} €</td>
                </tr>
            </tbody>
        </table>
        
        <div class="container bg-secondary-subtle mt-4 mb-2 p-2 d-flex justify-content-between">
            <a href="{{ path('home.index') }}" class="btn btn-outline-dark">
                Continuer mes réservations
            </a>
            {# Ajouter dans action le redirection vers la page de paiement #}
            {% if (app.user and total != 0) %}
                <a href="{{ path('app_payment') }}" class="btn btn-outline-dark">
                    Passer au paiement
                </a>
            {% else %}
                <a href="{{ path('app_payment') }}" class="btn btn-outline-secondary disabled">
                    Passer au paiement
                </a>
            {% endif %}
        </div>    

{% endblock %}

